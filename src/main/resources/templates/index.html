<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Aquafin neerslag</title>
    <link rel="stylesheet" th:href="@{css/main.css}" />

</head>
<body>
<nav>
    <img src="Aquafin.png" alt="Aquafin logo" class="logo" />
    <ul>
        <li><a th:href="@{/}">Home</a></li>
        <li><a th:href="@{/vorigeData}">Overzicht Data</a></li>
    </ul>
</nav>

<main class="mainIndex">
    <h2>Aquafin neerslag voorspelling</h2>

    <h3>Waarschuwingen voor neerslag</h3>
    <div th:if="${overstromingsgevaar}">
        <p class="warning">⚠️ Overstromingsgevaar in volgende steden:</p>
        <ul>
            <li th:each="stad : ${risicosteden}" th:text="${stad}"></li>
        </ul>
    </div>
    <div th:unless="${overstromingsgevaar}">
        <p class="safe">✅ Geen overstromingsgevaar. Alle steden onder de drempel van <span th:text="${risicoDrempel} + ' mm'"></span>.</p>
    </div>

    <h3>Neerslag voorspelling voor de volgende 5 dagen</h3>
    <pre th:text="${regenVoorspelling}"></pre>

    <h3>Live neerslagvoorspelling (grafiek)</h3>
    <canvas id="neerslagGrafiek" style="width:100%; max-width:900px; background:#fff; border-radius:14px; box-shadow:0 2px 10px #dde;"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:inline="javascript">
        let labels = /*[[${grafiekDatums}]]*/ [];
        let gemiddeldes = /*[[${grafiekGemiddelde}]]*/ [];
        let perStad = /*[[${grafiekPerStad}]]*/ {};

        if (typeof labels === "string") labels = JSON.parse(labels);
        if (typeof gemiddeldes === "string") gemiddeldes = JSON.parse(gemiddeldes);
        if (typeof perStad === "string") perStad = JSON.parse(perStad);

        const kleuren = [
            "#1abc9c","#e67e22","#2980b9","#c0392b","#16a085",
            "#8e44ad","#27ae60","#d35400","#7f8c8d","#2c3e50"
        ];
        let stadIndex = 0;
        let datasets = [
            {
                label: "Vlaams gemiddelde",
                data: gemiddeldes,
                borderColor: "#0a3d62",
                backgroundColor: "rgba(10,61,98,0.1)",
                borderWidth: 4,
                tension: 0.25,
                fill: true,
                pointRadius: 5
            }
        ];
        for (let stad in perStad) {
            datasets.push({
                label: stad,
                data: perStad[stad],
                borderColor: kleuren[stadIndex % kleuren.length],
                backgroundColor: "rgba(0,0,0,0)",
                borderWidth: 2,
                fill: false,
                tension: 0.25,
                pointRadius: 3
            });
            stadIndex++;
        }

        const ctx = document.getElementById('neerslagGrafiek').getContext('2d');
        const regenChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: datasets
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: { usePointStyle: true }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: "Neerslag (mm)" }
                    }
                }
            }
        });
    </script>


</main>

<footer>
    <p>Copyright ©2025 Aquafin - All rights reserved</p>
</footer>
</body>
</html>